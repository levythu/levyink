<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1, user-scalable=no" />
    <title>Blog - Levy's Ink</title>

	<link href="css/general.font.css" rel='stylesheet' type='text/css'>
	<link href="css/general.layout.css" rel='stylesheet' type='text/css'>
	<link href="css/general.effect.css" rel='stylesheet' type='text/css'>
	<link href="css/rheader.layout.css" rel='stylesheet' type='text/css'>
	<link href="css/foghorn.css" rel='stylesheet' type='text/css'>
	<link href="iconfont/icomoon/style.css" rel='stylesheet' type='text/css'>
	<link href="iconfont/icomoon-sns/style.css" rel='stylesheet' type='text/css'>
	<link href="css/pdetail.css" rel='stylesheet' type='text/css'>

	<script type="text/javascript">
		var p_detail=
		{
			author: "Levy",
			pubtime: 1436666120952,
			catalog: "技术博客",
			tag: ["开源项目","发布日志","Readme"]
		};
	</script>
	<script type="text/javascript" src="js/jquery/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="js/jquery/jquery.mobile-events.min.js"></script>
	<script type="text/javascript" src="js/protocolDeclare.js"></script>
	<script type="text/javascript" src="js/functionhelper.js"></script>
	<script type="text/javascript" src="js/effecthelper.js"></script>
	<script type="text/javascript" src="js/rheader.js"></script>
	<script type="text/javascript" src="js/pdetail.js"></script>
</head>
<body>
	<div id="toTop" class="transit_in_position">
		<span class="icon-arrow-up2 mid-white-glyph"></span>
	</div>
    <div id="topInk">
		<img id="giPic" width="100%" height="100%" src="image/ink_tailored-moded1.jpg" class="element_rel_stretch"/>
		<div id="latitle">
			<span id="bigtitle">
				Levy's ink.
			</span>
			<br/>
			<span id="smalltitle">
				Doodles, whimsy &amp; life.
			</span>
		</div>
		<div id="direct-panel">
			<div class="direct-panel-item transit_in_border" id="tab_me">
				<span class="direct-panel-item-text">About</span>
			</div>
			<div class="direct-panel-divisor">
			</div>
			<div class="direct-panel-item direct-panel-chosen transit_in_border" id="tab_blog">
				<span class="direct-panel-item-text">Blog</span>
			</div>
			<div class="direct-panel-divisor ">
			</div>
			<div class="direct-panel-item transit_in_border" id="tab_mess">
				<span class="direct-panel-item-text">Mess</span>
			</div>
		</div>

    </div>
	<div id="followedFrame">
		<div id="preInfo">
			<span class="icon-bookmark inlineblock tem_cata_tag codeStyle" style="color:rgb(232,17,35)"><span class="tem_cata">Catalog</span></span>
		</div>
		<div id="contentMain">
			<!---------------->

<h1 id="fonttailor">Font tailor</h1>
<h2 id="generalintro">General Intro</h2>
<p>A nodejs-based server used to provide RESTful API to get tailored font src from one particular websites. (That is, if the website has only three characters(asd), the tailored font will be as tiny as to hold only these three, thus reducing the data transfered for fontface)</p>
<h2 id="characters">Characters:</h2>
<ul>
<li>RESTful API: post url, fontname and encoding as parameters, get the url of .ttf file.</li>
<li>Two-phase caching: PHASE#1, cache the .ttf file based on url, updating it over expiring time; PHASE#2, caching based on SHA1 of content.</li>
<li>Garbage cleaning: scripts provided to automatically removing files that are no more needed by any cache.</li>
<li>Whitelist: regular-expression whitelist, only websites in them could be used to tailor fonts, thus saving storage and cpu.</li>
</ul>
<h2 id="furtherplans">Further plans:</h2>
<ul>
<li>Multiple process to accelerate response.</li>
<li>Automatic css/js for frontend.</li>
<li>Other relevant utilities</li>
</ul>
<h2 id="restapi">RestAPI</h2>
<ul>
<li><p>POST</p>
<ul>
<li>URL: server_root/</li>
<li>Arguments:
<ul>
<li>font: fontname(.ttf suffix excluded), should be contained in the server's font directory.</li>
<li>url: the url of website used for tailor.</li>
<li>[encoding]: encoding of the website, default is utf8.</li></ul></li>
<li>Returns:
<ul>
<li>Correct: the url of tailored ttf file.</li>
<li>Wrong: empty string.</li></ul></li></ul></li>
<li><p>GET(used for cross-domain fetch)</p>
<ul>
<li>URL: server_root/jspadding.js?queries</li>
<li>Queries:
<ul>
<li>font: same as above.</li>
<li>url: same as above.</li>
<li>[encoding]: same as above.</li>
<li>[addcss]: if specified, will get one js designed to add one @fontface css to the DOM; if not, one js containing the font-url will be returned. To modify the returned js, change views/*.ejs</li></ul></li></ul></li>
</ul>
<h2 id="howtodeploy">How to deploy</h2>
<ul>
<li>Download the source code by git.</li>
<li><code>$ npm install</code> to install all the dependencies. (For some components like express, root privilege may be needed.)</li>
<li>Modify /metadata/settings.js to specified settings.</li>
<li>Modify /metadata/whitelist.js to add whitelist entry using regexp.</li>
<li>Copy the source font to srcFontPath</li>
<li><code>$ npm start</code></li>
</ul>

			<div class="placeholder-1-5em"></div>
			<div class="placeholder-3em" id="lafin"></div>
			<!--COMMENTS--><!--COMMENTS--><!--COMMENTS--><!--COMMENTS--><!--COMMENTS-->
				<div id="hypercomments_widget"></div>
				<script type="text/javascript">
				_hcwp = window._hcwp || [];
				_hcwp.push({widget:"Stream", widget_id: 61768});
				(function() {
				if("HC_LOAD_INIT" in window)return;
				HC_LOAD_INIT = true;
				var lang = "en";
				var hcc = document.createElement("script"); hcc.type = "text/javascript"; hcc.async = true;
				hcc.src = ("https:" == document.location.protocol ? "https" : "http")+"://w.hypercomments.com/widget/hc/61768/"+lang+"/widget.js";
				var s = document.getElementsByTagName("script")[0];
				s.parentNode.insertBefore(hcc, s.nextSibling);
				})();
				</script>
				<a href="http://hypercomments.com" class="hc-link" title="comments widget">comments powered by HyperComments</a>
			<!--COMMENTS--><!--COMMENTS--><!--COMMENTS--><!--COMMENTS--><!--COMMENTS-->
		</div>
		<div id="footer">
			<p>By Levy, 2015. Copyright reserved.</p>
			<div class="px-20-placeholder"></div>
		</div>
	</div>

	<div id="floatBack" class="transit_in_opacity">
	</div>
</body>

</html>
